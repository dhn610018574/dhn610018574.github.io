<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Vue Function-based API RFC | 爱折腾的前端</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="基本例子12345678910111213141516171819202122232425262728293031323334353637&amp;lt;!-- 此处指已发布3.0版本的写法 如果还没有升级为vue3.0 那么应该这样引入 --&amp;gt;&amp;lt;!-- 安装 npm install @vue&#x2F;composition-api --save --&amp;gt;&amp;lt;!-- import &amp;#123;">
<meta name="keywords" content="董海南的前端生活">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue Function-based API RFC">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;11&#x2F;11&#x2F;vue3.0-api&#x2F;index.html">
<meta property="og:site_name" content="爱折腾的前端">
<meta property="og:description" content="基本例子12345678910111213141516171819202122232425262728293031323334353637&amp;lt;!-- 此处指已发布3.0版本的写法 如果还没有升级为vue3.0 那么应该这样引入 --&amp;gt;&amp;lt;!-- 安装 npm install @vue&#x2F;composition-api --save --&amp;gt;&amp;lt;!-- import &amp;#123;">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-11-11T07:25:53.652Z">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="爱折腾的前端" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">爱折腾的前端</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-vue3.0-api" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/11/vue3.0-api/" class="article-date">
  <time datetime="2019-11-11T07:25:53.652Z" itemprop="datePublished">2019-11-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Vue Function-based API RFC
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="基本例子"><a href="#基本例子" class="headerlink" title="基本例子"></a>基本例子</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 此处指已发布3.0版本的写法 如果还没有升级为vue3.0 那么应该这样引入 --&gt;</span><br><span class="line">&lt;!-- 安装 npm install @vue/composition-api --save --&gt;</span><br><span class="line">&lt;!-- import &#123; value, computed, watch, onMounted &#125; from &apos;@vue/composition-api&apos; --&gt;</span><br><span class="line"></span><br><span class="line">import &#123; value, computed, watch, onMounted &#125; from &apos;vue&apos;</span><br><span class="line"></span><br><span class="line">const App = &#123;</span><br><span class="line">  template: `</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;span&gt;count is &#123;&#123; count &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;plusOne is &#123;&#123; plusOne &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;increment&quot;&gt;count++&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // reactive state</span><br><span class="line">    const count = value(0)</span><br><span class="line">    // computed state</span><br><span class="line">    const plusOne = computed(() =&gt; count.value + 1)</span><br><span class="line">    // method</span><br><span class="line">    const increment = () =&gt; &#123; count.value++ &#125;</span><br><span class="line">    // watch</span><br><span class="line">    watch(() =&gt; count.value * 2, val =&gt; &#123;</span><br><span class="line">      console.log(`count * 2 is $&#123;val&#125;`)</span><br><span class="line">    &#125;)</span><br><span class="line">    // lifecycle</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      console.log(`mounted`)</span><br><span class="line">    &#125;)</span><br><span class="line">    // expose bindings on render context</span><br><span class="line">    return &#123;</span><br><span class="line">      count,</span><br><span class="line">      plusOne,</span><br><span class="line">      increment</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1、setup"><a href="#1、setup" class="headerlink" title="1、setup"></a>1、setup</h3><p>setup() 函数是 vue3 中专门为组件提供的新属性，它为我们的使用 vue3 的 Composition API 新特性提供了统一的入口。</p>
<h2 id="1-1-执行时机"><a href="#1-1-执行时机" class="headerlink" title="1.1 执行时机"></a>1.1 执行时机</h2><p>setup 函数会在 beforeCreate 之后、created 之前执行。</p>
<h2 id="1-2-接收-props-数据"><a href="#1-2-接收-props-数据" class="headerlink" title="1.2 接收 props 数据"></a>1.2 接收 props 数据</h2><pre><code>1、在props中定义当前组件允许外界传递过来的参数名称：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  p1: String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
2、通过setup 函数的第一个形参，接收props数据
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setup(props)&#123;</span><br><span class="line">  console.log(props.p1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><h2 id="1-3-context"><a href="#1-3-context" class="headerlink" title="1.3 context"></a>1.3 context</h2><p>setup 函数的第二个形参是一个上下文对象，这个上下文对象中包含了一些有用的属性，这些属性在 vue2.x 中需要通过 this 才能访问，在 vue3.x 中，它们的访问方式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const MyComponent = &#123;</span><br><span class="line">  setup(props,context)&#123;</span><br><span class="line">    context.attrs</span><br><span class="line">    context.slots</span><br><span class="line">    context.parent</span><br><span class="line">    context.root</span><br><span class="line">    context.emit</span><br><span class="line">    context.refs</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：在 setup() 函数中无法访问到 this</p>
<h3 id="2-reactive"><a href="#2-reactive" class="headerlink" title="2 reactive"></a>2 reactive</h3><p>reactive() 函数接收一个普通对象，返回一个响应式的数据对象</p>
<h2 id="2-1-基本语法"><a href="#2-1-基本语法" class="headerlink" title="2.1 基本语法"></a>2.1 基本语法</h2><p>等价于 vue2.x 中的 Vue.observable() 函数，vue3.x 中提供了 reactive() 函数，用来创建响应式的数据对象，基本代码示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123;reactive&#125; from &apos;@vue/composition-api&apos;</span><br><span class="line">&lt;!-- 创建响应式数据对象，得到state类似于vue2.x中 data() 返回的响应式对象 --&gt;</span><br><span class="line">const state = reactive(&#123;count:0&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="2-2-定义响应式数据供-template-使用"><a href="#2-2-定义响应式数据供-template-使用" class="headerlink" title="2.2 定义响应式数据供 template 使用"></a>2.2 定义响应式数据供 template 使用</h2><p>1、按需导入 reactive</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123;reactive&#125; from &apos;@vue/compositon-api&apos;</span><br></pre></td></tr></table></figure>

<p>2、在 setup() 函数中调用 reactive() 函数，创建响应式数据对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setup()&#123;</span><br><span class="line">  const state = reactive(&#123;count:0&#125;)</span><br><span class="line">  return state</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、在 template 中访问响应式数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;当前的count值为：&#123;&#123;count&#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-ref"><a href="#3-ref" class="headerlink" title="3.ref"></a>3.ref</h3><h2 id="3-1-基本语法"><a href="#3-1-基本语法" class="headerlink" title="3.1 基本语法"></a>3.1 基本语法</h2><p>ref() 函数用来根据给定的值创建一个 <code>响应式的数据对象</code>, ref()函数调用的返回值是一个对象，这个对象上只包含一个<code>.value</code>属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">// 创建响应式数据对象 count，初始值为 0</span><br><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">// 如果要访问 ref() 创建出来的响应式数据对象的值，必须通过 .value 属性才可以</span><br><span class="line">console.log(count.value) // 输出 0</span><br><span class="line">// 让 count 的值 +1</span><br><span class="line">count.value++</span><br><span class="line">// 再次打印 count 的值</span><br><span class="line">console.log(count.value) // 输出 1</span><br></pre></td></tr></table></figure>

<h2 id="3-2-在-template-中访问-ref-创建的响应式数据"><a href="#3-2-在-template-中访问-ref-创建的响应式数据" class="headerlink" title="3.2 在 template 中访问 ref 创建的响应式数据"></a>3.2 在 template 中访问 ref 创建的响应式数据</h2><p>1、在 setup() 中创建响应式数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">setup() &#123;</span><br><span class="line">    const count = ref(0)</span><br><span class="line"></span><br><span class="line">     return &#123;</span><br><span class="line">         count,</span><br><span class="line">         name: ref(&apos;zs&apos;)</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在 template 中访问响应式数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123;count&#125;&#125; --- &#123;&#123;name&#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-在-reactive-对象中访问-ref-创建的响应式数据"><a href="#3-3-在-reactive-对象中访问-ref-创建的响应式数据" class="headerlink" title="3.3 在 reactive 对象中访问 ref 创建的响应式数据"></a>3.3 在 reactive 对象中访问 ref 创建的响应式数据</h2><p>当把 ref() 创建出来的响应式数据对象，挂载到 reactive() 上时，会自动把响应式数据对象展开为原始的值，不需通过 .value 就可以直接被访问，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const count = ref(0)</span><br><span class="line">const state = reactive(&#123;</span><br><span class="line">  count</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">console.log(state.count) // 输出 0</span><br><span class="line">state.count++ // 此处不需要通过 .value 就能直接访问原始值</span><br><span class="line">console.log(count) // 输出 1</span><br></pre></td></tr></table></figure>

<p>注意：新的 ref 会覆盖旧的 ref，示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 创建 ref 并挂载到 reactive 中</span><br><span class="line">const c1 = ref(0)</span><br><span class="line">const state = reactive(&#123;</span><br><span class="line">  c1</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 再次创建 ref，命名为 c2</span><br><span class="line">const c2 = ref(9)</span><br><span class="line">// 将 旧 ref c1 替换为 新 ref c2</span><br><span class="line">state.c1 = c2</span><br><span class="line">state.c1++</span><br><span class="line"></span><br><span class="line">console.log(state.c1) // 输出 10</span><br><span class="line">console.log(c2.value) // 输出 10</span><br><span class="line">console.log(c1.value) // 输出 0</span><br></pre></td></tr></table></figure>

<h3 id="4-isRef"><a href="#4-isRef" class="headerlink" title="4 isRef"></a>4 isRef</h3><p>isRef() 用来判断某个值是否为 ref() 创建出来的对象；应用场景：当需要展开某个可能为 ref() 创建出来的值的时候，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; isRef &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">const unwrapped = isRef(foo) ? foo.value : foo</span><br></pre></td></tr></table></figure>

<h3 id="5-toRefs"><a href="#5-toRefs" class="headerlink" title="5 toRefs"></a>5 toRefs</h3><p>toRefs() 函数可以将 reactive() 创建出来的响应式对象，转换为普通的对象，只不过，这个对象上的每个属性节点，都是 ref() 类型的响应式数据，最常见的应用场景如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import &#123; toRefs &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">setup() &#123;</span><br><span class="line">    // 定义响应式数据对象</span><br><span class="line">    const state = reactive(&#123;</span><br><span class="line">      count: 0</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 定义页面上可用的事件处理函数</span><br><span class="line">    const increment = () =&gt; &#123;</span><br><span class="line">      state.count++</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 在 setup 中返回一个对象供页面使用</span><br><span class="line">    // 这个对象中可以包含响应式的数据，也可以包含事件处理函数</span><br><span class="line">    return &#123;</span><br><span class="line">      // 将 state 上的每个属性，都转化为 ref 形式的响应式数据</span><br><span class="line">      ...toRefs(state),</span><br><span class="line">      // 自增的事件处理函数</span><br><span class="line">      increment</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>页面上可以直接访问 setup() 中 return 出来的响应式数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;p&gt;当前的count值为：&#123;&#123;count&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;button @click=&quot;increment&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-computed"><a href="#5-computed" class="headerlink" title="5 computed"></a>5 computed</h3><p>computed() 用来创建计算属性，computed() 函数的返回值是一个 ref 的实例。使用 computed 之前需要按需导入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; computed &#125; from &apos;@vue/composition-api&apos;</span><br></pre></td></tr></table></figure>
<h2 id="5-1-创建只读的计算属性"><a href="#5-1-创建只读的计算属性" class="headerlink" title="5.1 创建只读的计算属性"></a>5.1 创建只读的计算属性</h2><p>在调用 computed() 函数期间，传入一个 function 函数，可以得到一个只读的计算属性，示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个 ref 响应式数据</span><br><span class="line">const count = ref(1)</span><br><span class="line"></span><br><span class="line">// 根据 count 的值，创建一个响应式的计算属性 plusOne</span><br><span class="line">// 它会根据依赖的 ref 自动计算并返回一个新的 ref</span><br><span class="line">const plusOne = computed(() =&gt; count.value + 1)</span><br><span class="line"></span><br><span class="line">console.log(plusOne.value) // 输出 2</span><br><span class="line">plusOne.value++ // error</span><br></pre></td></tr></table></figure>
<h2 id="5-2-创建可读可写的计算属性"><a href="#5-2-创建可读可写的计算属性" class="headerlink" title="5.2 创建可读可写的计算属性"></a>5.2 创建可读可写的计算属性</h2><p>在调用 computed() 函数期间，传入一个包含 get 和 set 函数的对象，可以得到一个可读可写的计算属性，示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 创建一个 ref 响应式数据</span><br><span class="line">const count = ref(1)</span><br><span class="line"></span><br><span class="line">// 创建一个 computed 计算属性</span><br><span class="line">const plusOne = computed(&#123;</span><br><span class="line">  // 取值函数</span><br><span class="line">  get: () =&gt; count.value + 1,</span><br><span class="line">  // 赋值函数</span><br><span class="line">  set: val =&gt; &#123;</span><br><span class="line">    count.value = val - 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 为计算属性赋值的操作，会触发 set 函数</span><br><span class="line">plusOne.value = 9</span><br><span class="line">// 触发 set 函数后，count 的值会被更新</span><br><span class="line">console.log(count.value) // 输出 8</span><br></pre></td></tr></table></figure>

<h3 id="6-watch"><a href="#6-watch" class="headerlink" title="6 watch"></a>6 watch</h3><p>watch() 函数用来监视某些数据项的变化，从而触发某些特定的操作，使用之前需要按需导入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; watch &#125; from &apos;@vue/composition-api&apos;</span><br></pre></td></tr></table></figure>
<h2 id="6-1-基本用法"><a href="#6-1-基本用法" class="headerlink" title="6.1 基本用法"></a>6.1 基本用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">// 定义 watch，只要 count 值变化，就会触发 watch 回调</span><br><span class="line">// watch 会在创建时会自动调用一次</span><br><span class="line">watch(() =&gt; console.log(count.value))</span><br><span class="line">// 输出 0</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  count.value++</span><br><span class="line">  // 输出 1</span><br><span class="line">&#125;, 1000)</span><br></pre></td></tr></table></figure>

<h2 id="6-2-监视指定的数据源"><a href="#6-2-监视指定的数据源" class="headerlink" title="6.2 监视指定的数据源"></a>6.2 监视指定的数据源</h2><p>监视 reactive 类型的数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 定义数据源</span><br><span class="line">const state = reactive(&#123; count: 0 &#125;)</span><br><span class="line">// 监视 state.count 这个数据节点的变化</span><br><span class="line">watch(</span><br><span class="line">  () =&gt; state.count,</span><br><span class="line">  (count, prevCount) =&gt; &#123;</span><br><span class="line">    /* ... */</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>监视 ref 类型的数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 定义数据源</span><br><span class="line">const count = ref(0)</span><br><span class="line">// 指定要监视的数据源</span><br><span class="line">watch(count, (count, prevCount) =&gt; &#123;</span><br><span class="line">  /* ... */</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="6-3-监视多个数据源"><a href="#6-3-监视多个数据源" class="headerlink" title="6.3  监视多个数据源"></a>6.3  监视多个数据源</h2><p>监视 reactive 类型的数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const state = reactive(&#123; count: 0, name: &apos;zs&apos; &#125;)</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  [() =&gt; state.count, () =&gt; state.name], // Object.values(toRefs(state)),</span><br><span class="line">  ([count, name], [prevCount, prevName]) =&gt; &#123;</span><br><span class="line">    console.log(count) // 新的 count 值</span><br><span class="line">    console.log(name) // 新的 name 值</span><br><span class="line">    console.log(&apos;------------&apos;)</span><br><span class="line">    console.log(prevCount) // 旧的 count 值</span><br><span class="line">    console.log(prevName) // 新的 name 值</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    lazy: true // 在 watch 被创建的时候，不执行回调函数中的代码</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  state.count++</span><br><span class="line">  state.name = &apos;ls&apos;</span><br><span class="line">&#125;, 1000)</span><br></pre></td></tr></table></figure>
<p>监视 ref 类型的数据源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const count = ref(0)</span><br><span class="line">const name = ref(&apos;zs&apos;)</span><br><span class="line"></span><br><span class="line">watch(</span><br><span class="line">  [count, name], // 需要被监视的多个 ref 数据源</span><br><span class="line">  ([count, name], [prevCount, prevName]) =&gt; &#123;</span><br><span class="line">    console.log(count)</span><br><span class="line">    console.log(name)</span><br><span class="line">    console.log(&apos;-------------&apos;)</span><br><span class="line">    console.log(prevCount)</span><br><span class="line">    console.log(prevName)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    lazy: true</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  count.value++</span><br><span class="line">  name.value = &apos;xiaomaolv&apos;</span><br><span class="line">&#125;, 1000)</span><br></pre></td></tr></table></figure>
<h2 id="6-4-清除监视"><a href="#6-4-清除监视" class="headerlink" title="6.4 清除监视"></a>6.4 清除监视</h2><p>在 setup() 函数内创建的 watch 监视，会在当前组件被销毁的时候自动停止。如果想要明确地停止某个监视，可以调用 watch() 函数的返回值即可，语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 创建监视，并得到 停止函数</span><br><span class="line">const stop = watch(() =&gt; &#123;</span><br><span class="line">  /* ... */</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 调用停止函数，清除对应的监视</span><br><span class="line">stop()</span><br></pre></td></tr></table></figure>

<h2 id="6-5-在-watch-中清除无效的异步任务"><a href="#6-5-在-watch-中清除无效的异步任务" class="headerlink" title="6.5 在 watch 中清除无效的异步任务"></a>6.5 在 watch 中清除无效的异步任务</h2><p>有时候，当被 watch 监视的值发生变化时，或 watch 本身被 stop 之后，我们期望能够清除那些无效的异步任务，此时，watch 回调函数中提供了一个 cleanup registrator function 来执行清除的工作。这个清除函数会在如下情况下被调用：</p>
<p>watch 被重复执行了<br>watch 被强制 stop 了<br>Template 中的代码示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/* template 中的代码 */ &lt;input type=&quot;text&quot; v-model=&quot;keywords&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>Script 中的代码示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// 定义响应式数据 keywords</span><br><span class="line">const keywords = ref(&apos;&apos;)</span><br><span class="line"></span><br><span class="line">// 异步任务：打印用户输入的关键词</span><br><span class="line">const asyncPrint = val =&gt; &#123;</span><br><span class="line">  // 延时 1 秒后打印</span><br><span class="line">  return setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(val)</span><br><span class="line">  &#125;, 1000)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 定义 watch 监听</span><br><span class="line">watch(</span><br><span class="line">  keywords,</span><br><span class="line">  (keywords, prevKeywords, onCleanup) =&gt; &#123;</span><br><span class="line">    // 执行异步任务，并得到关闭异步任务的 timerId</span><br><span class="line">    const timerId = asyncPrint(keywords)</span><br><span class="line"></span><br><span class="line">    // 如果 watch 监听被重复执行了，则会先清除上次未完成的异步任务</span><br><span class="line">    onCleanup(() =&gt; clearTimeout(timerId))</span><br><span class="line">  &#125;,</span><br><span class="line">  // watch 刚被创建的时候不执行</span><br><span class="line">  &#123; lazy: true &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 把 template 中需要的数据 return 出去</span><br><span class="line">return &#123;</span><br><span class="line">  keywords</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-LifeCycle-Hooks"><a href="#7-LifeCycle-Hooks" class="headerlink" title="7 LifeCycle Hooks"></a>7 LifeCycle Hooks</h3><p>新版的生命周期函数，可以按需导入到组件中，且只能在 setup() 函数中使用，代码示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted, onUpdated, onUnmounted &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">const MyComponent = &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;mounted!&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onUpdated(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;updated!&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">    onUnmounted(() =&gt; &#123;</span><br><span class="line">      console.log(&apos;unmounted!&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面的列表，是 vue 2.x 的生命周期函数与新版 Composition API 之间的映射关系：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate -&gt; use setup()</span><br><span class="line">created -&gt; use setup()</span><br><span class="line">beforeMount -&gt; onBeforeMount</span><br><span class="line">mounted -&gt; onMounted</span><br><span class="line">beforeUpdate -&gt; onBeforeUpdate</span><br><span class="line">updated -&gt; onUpdated</span><br><span class="line">beforeDestroy -&gt; onBeforeUnmount</span><br><span class="line">destroyed -&gt; onUnmounted</span><br><span class="line">errorCaptured -&gt; onErrorCaptured</span><br></pre></td></tr></table></figure>
<h3 id="8-provide-amp-inject"><a href="#8-provide-amp-inject" class="headerlink" title="8 provide &amp; inject"></a>8 provide &amp; inject</h3><p>provide() 和 inject() 可以实现嵌套组件之间的数据传递。这两个函数只能在 setup() 函数中使用。父级组件中使用 provide() 函数向下传递数据；子级组件中使用 inject() 获取上层传递过来的数据。</p>
<h2 id="8-1-共享普通数据"><a href="#8-1-共享普通数据" class="headerlink" title="8.1 共享普通数据"></a>8.1 共享普通数据</h2><p>App.vue 根组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;h1&gt;App 根组件&lt;/h1&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;LevelOne /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import LevelOne from &apos;./components/LevelOne&apos;</span><br><span class="line">// 1. 按需导入 provide</span><br><span class="line">import &#123; provide &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &apos;app&apos;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 2. App 根组件作为父级组件，通过 provide 函数向子级组件共享数据（不限层级）</span><br><span class="line">    //    provide(&apos;要共享的数据名称&apos;, 被共享的数据)</span><br><span class="line">    provide(&apos;globalColor&apos;, &apos;red&apos;)</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    LevelOne</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>LevelOne.vue 组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 4. 通过属性绑定，为标签设置字体颜色 --&gt;</span><br><span class="line">    &lt;h3 :style=&quot;&#123;color: themeColor&#125;&quot;&gt;Level One&lt;/h3&gt;</span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;LevelTwo /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import LevelTwo from &apos;./LevelTwo&apos;</span><br><span class="line">// 1. 按需导入 inject</span><br><span class="line">import &#123; inject &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 2. 调用 inject 函数时，通过指定的数据名称，获取到父级共享的数据</span><br><span class="line">    const themeColor = inject(&apos;globalColor&apos;)</span><br><span class="line"></span><br><span class="line">    // 3. 把接收到的共享数据 return 给 Template 使用</span><br><span class="line">    return &#123;</span><br><span class="line">      themeColor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    LevelTwo</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>LevelTwo.vue 组件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 4. 通过属性绑定，为标签设置字体颜色 --&gt;</span><br><span class="line">    &lt;h5 :style=&quot;&#123;color: themeColor&#125;&quot;&gt;Level Two&lt;/h5&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// 1. 按需导入 inject</span><br><span class="line">import &#123; inject &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 2. 调用 inject 函数时，通过指定的数据名称，获取到父级共享的数据</span><br><span class="line">    const themeColor = inject(&apos;globalColor&apos;)</span><br><span class="line"></span><br><span class="line">    // 3. 把接收到的共享数据 return 给 Template 使用</span><br><span class="line">    return &#123;</span><br><span class="line">      themeColor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="8-2-共享-ref-响应式数据"><a href="#8-2-共享-ref-响应式数据" class="headerlink" title="8.2 共享 ref 响应式数据"></a>8.2 共享 ref 响应式数据</h2><p>如下代码实现了点按钮切换主题颜色的功能，主要修改了 App.vue 组件中的代码，LevelOne.vue 和 LevelTwo.vue 中的代码不受任何改变：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;h1&gt;App 根组件&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 点击 App.vue 中的按钮，切换子组件中文字的颜色 --&gt;</span><br><span class="line">    &lt;button @click=&quot;themeColor=&apos;red&apos;&quot;&gt;红色&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;themeColor=&apos;blue&apos;&quot;&gt;蓝色&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;themeColor=&apos;orange&apos;&quot;&gt;橘黄色&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;LevelOne /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import LevelOne from &apos;./components/LevelOne&apos;</span><br><span class="line">import &#123; provide, ref &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &apos;app&apos;,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 定义 ref 响应式数据</span><br><span class="line">    const themeColor = ref(&apos;red&apos;)</span><br><span class="line"></span><br><span class="line">    // 把 ref 数据通过 provide 提供的子组件使用</span><br><span class="line">    provide(&apos;globalColor&apos;, themeColor)</span><br><span class="line"></span><br><span class="line">    // setup 中 return 数据供当前组件的 Template 使用</span><br><span class="line">    return &#123;</span><br><span class="line">      themeColor</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    LevelOne</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="9-template-refs"><a href="#9-template-refs" class="headerlink" title="9 template refs"></a>9 template refs</h3><p>通过 ref() 还可以引用页面上的元素或组件。</p>
<h2 id="9-1-元素的引用"><a href="#9-1-元素的引用" class="headerlink" title="9.1 元素的引用"></a>9.1 元素的引用</h2><p>示例代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h3 ref=&quot;h3Ref&quot;&gt;TemplateRefOne&lt;/h3&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 创建一个 DOM 引用</span><br><span class="line">    const h3Ref = ref(null)</span><br><span class="line"></span><br><span class="line">    // 在 DOM 首次加载完毕之后，才能获取到元素的引用</span><br><span class="line">    onMounted(() =&gt; &#123;</span><br><span class="line">      // 为 dom 元素设置字体颜色</span><br><span class="line">      // h3Ref.value 是原生DOM对象</span><br><span class="line">      h3Ref.value.style.color = &apos;red&apos;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 把创建的引用 return 出去</span><br><span class="line">    return &#123;</span><br><span class="line">      h3Ref</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="9-2-组件的引用"><a href="#9-2-组件的引用" class="headerlink" title="9.2 组件的引用"></a>9.2 组件的引用</h2><p>TemplateRefOne.vue 中的示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h3&gt;TemplateRefOne&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 4. 点击按钮展示子组件的 count 值 --&gt;</span><br><span class="line">    &lt;button @click=&quot;showNumber&quot;&gt;获取TemplateRefTwo中的count值&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;hr /&gt;</span><br><span class="line">    &lt;!-- 3. 为组件添加 ref 引用 --&gt;</span><br><span class="line">    &lt;TemplateRefTwo ref=&quot;comRef&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line">import TemplateRefTwo from &apos;./TemplateRefTwo&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 1. 创建一个组件的 ref 引用</span><br><span class="line">    const comRef = ref(null)</span><br><span class="line"></span><br><span class="line">    // 5. 展示子组件中 count 的值</span><br><span class="line">    const showNumber = () =&gt; &#123;</span><br><span class="line">      console.log(comRef.value.count)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 2. 把创建的引用 return 出去</span><br><span class="line">    return &#123;</span><br><span class="line">      comRef,</span><br><span class="line">      showNumber</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    TemplateRefTwo</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>TemplateRefTwo.vue 中的示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h5&gt;TemplateRefTwo --- &#123;&#123;count&#125;&#125;&lt;/h5&gt;</span><br><span class="line">    &lt;!-- 3. 点击按钮，让 count 值自增 +1 --&gt;</span><br><span class="line">    &lt;button @click=&quot;count+=1&quot;&gt;+1&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; ref &#125; from &apos;@vue/composition-api&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    // 1. 定义响应式的数据</span><br><span class="line">    const count = ref(0)</span><br><span class="line"></span><br><span class="line">    // 2. 把响应式数据 return 给 Template 使用</span><br><span class="line">    return &#123;</span><br><span class="line">      count</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="10-createComponent"><a href="#10-createComponent" class="headerlink" title="10 createComponent"></a>10 createComponent</h3><p>这个函数不是必须的，除非你想要完美结合 TypeScript 提供的类型推断来进行项目的开发。<br>这个函数仅仅提供了类型推断，方便在结合 TypeScript 书写代码时，能为 setup() 中的 props 提供完整的类型推断。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createComponent &#125; from &apos;vue&apos;</span><br><span class="line"></span><br><span class="line">export default createComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    foo: String</span><br><span class="line">  &#125;,</span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    props.foo // &lt;- type: string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/11/vue3.0-api/" data-id="ck2u3rzjt0000ngsedles215h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/11/11/vue3.0-api/">Vue Function-based API RFC</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Dong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>